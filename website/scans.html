<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Scans - ASIN Scout Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg:#0a0a0f;--bg2:#12121a;--bg3:#1a1a25;--text:#f0f0f5;--text2:#9898a8;--text3:#5a5a6e;--orange:#ff6b2c;--green:#22c97a;--blue:#4d8eff;--red:#ff4d5e;--border:#2a2a35}
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text)}
        .sidebar{position:fixed;left:0;top:0;bottom:0;width:250px;background:var(--bg2);border-right:1px solid var(--border);padding:20px;display:flex;flex-direction:column}
        .sidebar-logo{display:flex;align-items:center;gap:10px;font-size:18px;font-weight:800;margin-bottom:40px;text-decoration:none;color:var(--text)}
        .sidebar-logo span{color:var(--orange)}
        .sidebar-logo .icon{width:36px;height:36px;background:linear-gradient(135deg,#ff2c6b,var(--orange));border-radius:10px;display:flex;align-items:center;justify-content:center}
        .sidebar-menu{list-style:none;flex:1}
        .sidebar-menu a{display:block;padding:12px 16px;color:var(--text2);text-decoration:none;border-radius:10px;margin-bottom:4px;font-size:14px}
        .sidebar-menu a:hover,.sidebar-menu a.active{background:var(--bg3);color:var(--text)}
        .sidebar-menu a.active{color:var(--orange)}
        .sidebar-user{border-top:1px solid var(--border);padding-top:20px;display:flex;align-items:center;gap:12px}
        .sidebar-user .avatar{width:36px;height:36px;min-width:36px;min-height:36px;flex-shrink:0;background:var(--orange);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:14px}
        .sidebar-user .name{font-size:13px;font-weight:600}
        .sidebar-user .email{font-size:11px;color:var(--text3)}
        .lang-switch{display:flex;gap:6px;margin-top:15px;padding-top:15px;border-top:1px solid var(--border)}
        .lang-btn{flex:1;background:transparent;border:1px solid var(--border);color:var(--text2);padding:8px;border-radius:6px;cursor:pointer;font-size:12px}
        .lang-btn:hover,.lang-btn.active{border-color:var(--orange);color:var(--orange)}
        .main{margin-left:250px;padding:30px}
        .page-title{font-size:28px;font-weight:700;margin-bottom:30px}
        .card{background:var(--bg2);border:1px solid var(--border);border-radius:16px;padding:24px}
        table{width:100%;border-collapse:collapse}
        th,td{text-align:left;padding:14px;border-bottom:1px solid var(--border);font-size:13px}
        th{color:var(--text2);font-size:11px;text-transform:uppercase;background:var(--bg3)}
        tr:hover{background:var(--bg3)}
        .badge{padding:4px 10px;border-radius:20px;font-size:11px;font-weight:600}
        .badge.green{background:rgba(34,201,122,0.15);color:var(--green)}
        .badge.red{background:rgba(255,77,94,0.15);color:var(--red)}
        .btn{padding:6px 12px;border:none;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;text-decoration:none;margin-right:4px}
        .btn-outline{background:transparent;border:1px solid var(--border);color:var(--text)}
        .btn-outline:hover{border-color:var(--orange);color:var(--orange)}
        .btn-red{background:rgba(255,77,94,0.15);color:var(--red);border:1px solid rgba(255,77,94,0.3)}
        .btn-copy{background:rgba(77,142,255,0.15);color:var(--blue);border:1px solid rgba(77,142,255,0.3)}
        .btn-copy:hover{background:rgba(77,142,255,0.25)}
        .btn-copy.copied{background:var(--green);border-color:var(--green);color:#fff}
        .btn-sr{background:linear-gradient(135deg,#7c5ce0,#6b4ecf);color:#fff;border:none}
        .btn-sr:hover{box-shadow:0 2px 8px rgba(124,92,224,0.4)}
        .btn-sf{background:linear-gradient(135deg,#ff6b2c,#ff2c6b);color:#fff;border:none}
        .btn-sf:hover{box-shadow:0 2px 8px rgba(255,107,44,0.4)}
        .empty{text-align:center;padding:60px;color:var(--text2)}
        .pagination{display:flex;justify-content:center;gap:8px;margin-top:20px}
        .pagination button{padding:8px 14px;background:var(--bg3);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer}
        .pagination button:disabled{opacity:0.5}
        .mobile-toggle{display:none;position:fixed;top:12px;left:12px;z-index:1001;background:var(--bg2,#12121a);border:1px solid var(--border,#2a2a35);border-radius:8px;padding:8px 12px;color:var(--text,#f0f0f5);font-size:18px;cursor:pointer}
        .sidebar-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:999}
        @media(max-width:768px){.mobile-toggle{display:block}.sidebar{transform:translateX(-100%);transition:transform 0.3s;z-index:1000}.sidebar.open{transform:translateX(0)}.main{margin-left:0}.sidebar-overlay.active{display:block}}
        /* Copy Modal */
        .copy-modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:2000;align-items:center;justify-content:center}
        .copy-modal.active{display:flex}
        .copy-modal-box{background:#f5f5f5;border-radius:12px;padding:20px;min-width:340px;max-width:90%;position:relative}
        .copy-modal-title{font-size:18px;font-weight:700;color:#333;margin-bottom:16px}
        .copy-modal-close{position:absolute;top:10px;right:14px;background:#fff;border:1px solid #ccc;width:28px;height:28px;border-radius:4px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center}
        .copy-modal-close:hover{background:#eee}
        .chunk-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
        .chunk-btn{background:linear-gradient(135deg,#7c5ce0,#6b4ecf);color:#fff;border:none;padding:14px 20px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.2s}
        .chunk-btn:hover{transform:scale(1.02);box-shadow:0 4px 12px rgba(124,92,224,0.4)}
        .chunk-btn.copied{background:linear-gradient(135deg,#22c97a,#1db36a)}
        .copy-all-btn{width:100%;margin-top:12px;background:linear-gradient(135deg,#ff6b2c,#e55a1f);padding:12px;border-radius:8px;border:none;color:#fff;font-weight:600;cursor:pointer}
        .copy-all-btn:hover{box-shadow:0 4px 12px rgba(255,107,44,0.4)}
        /* Extension Install Modal */
        .ext-modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:3000;align-items:center;justify-content:center}
        .ext-modal.active{display:flex}
        .ext-modal-box{background:var(--bg2);border:1px solid var(--border);border-radius:16px;padding:30px;max-width:500px;width:90%;position:relative}
        .ext-modal-close{position:absolute;top:12px;right:12px;background:var(--bg3);border:1px solid var(--border);width:32px;height:32px;border-radius:8px;color:var(--text2);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center}
        .ext-modal-close:hover{background:var(--border);color:var(--text)}
        .ext-modal-icon{width:70px;height:70px;background:linear-gradient(135deg,#ff2c6b,var(--orange));border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto 20px}
        .ext-modal-title{text-align:center;font-size:22px;font-weight:700;margin-bottom:8px}
        .ext-modal-subtitle{text-align:center;font-size:14px;color:var(--text2);margin-bottom:24px}
        .ext-download-btn{display:block;width:100%;padding:14px;background:linear-gradient(135deg,var(--orange),#ff2c6b);color:#fff;border:none;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;text-align:center;text-decoration:none;margin-bottom:20px}
        .ext-download-btn:hover{box-shadow:0 4px 20px rgba(255,107,44,0.4);transform:translateY(-1px)}
        .ext-steps{background:var(--bg3);border-radius:12px;padding:20px}
        .ext-steps-title{font-size:14px;font-weight:600;color:var(--orange);margin-bottom:16px;display:flex;align-items:center;gap:8px}
        .ext-step{display:flex;gap:12px;margin-bottom:14px}
        .ext-step:last-child{margin-bottom:0}
        .ext-step-num{width:24px;height:24px;min-width:24px;background:var(--orange);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff}
        .ext-step-text{font-size:13px;color:var(--text2);line-height:1.5}
        .ext-step-text strong{color:var(--text)}
    </style>
</head>
<body data-i18n-title="scans_title">
<button class="mobile-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open');document.querySelector('.sidebar-overlay').classList.toggle('active')">&#9776;</button>
<div class="sidebar-overlay" onclick="document.querySelector('.sidebar').classList.remove('open');this.classList.remove('active')"></div>
    <aside class="sidebar">
        <a href="index.html" class="sidebar-logo"><div class="icon">A</div>ASIN<span>Scout</span></a>
        <ul class="sidebar-menu">
            <a href="dashboard.html" data-i18n="sidebar_dashboard">üìä Dashboard</a>
            <a href="scans.html" class="active" data-i18n="sidebar_scans">üìÅ My Scans</a>
            <a href="affiliate.html" id="affiliateLink" style="display:none">ü§ù Affiliate</a>
            <a href="pricing.html" data-i18n="sidebar_buy">üí≥ Buy Package</a>
            <a href="settings.html" data-i18n="sidebar_settings">‚öôÔ∏è Settings</a>
            <a href="#" onclick="logout()" data-i18n="sidebar_logout">üö™ Logout</a>
        </ul>
        <div class="sidebar-user">
            <div class="avatar" id="userAvatar">U</div>
            <div><div class="name" id="userName">User</div><div class="email" id="userEmail">...</div></div>
        </div>
        <div class="lang-switch">
            <button class="lang-btn" data-lang="en" onclick="setLanguage('en')">EN</button>
            <button class="lang-btn" data-lang="tr" onclick="setLanguage('tr')">TR</button>
        </div>
    </aside>
    <main class="main">
        <h1 class="page-title" data-i18n="scans_title">My Scans</h1>
        <div class="card">
            <div id="scansContainer"><div class="empty" data-i18n="scans_loading">Loading...</div></div>
            <div class="pagination" id="pagination" style="display:none">
                <button id="prevBtn" onclick="loadScans(currentPage-1)" data-i18n="scans_prev">‚Üê Prev</button>
                <span id="pageInfo" style="padding:8px 14px;color:var(--text2)">Page 1</span>
                <button id="nextBtn" onclick="loadScans(currentPage+1)" data-i18n="scans_next">Next ‚Üí</button>
            </div>
        </div>
    </main>

    <!-- Copy Modal -->
    <div class="copy-modal" id="copyModal">
        <div class="copy-modal-box">
            <div class="copy-modal-title">Kopyala</div>
            <button class="copy-modal-close" onclick="closeCopyModal()">&times;</button>
            <div class="chunk-grid" id="chunkGrid"></div>
            <button class="copy-all-btn" id="copyAllBtn" onclick="copyAllAsins()">T√ºm√ºn√º Kopyala</button>
        </div>
    </div>

    <!-- Extension Install Modal -->
    <div class="ext-modal" id="extModal">
        <div class="ext-modal-box">
            <button class="ext-modal-close" onclick="closeExtModal()">&times;</button>
            <div class="ext-modal-icon">A</div>
            <div class="ext-modal-title" data-i18n="ext_modal_title">Eklenti Gerekli</div>
            <div class="ext-modal-subtitle" data-i18n="ext_modal_subtitle">SR/SF'ye y√ºklemek i√ßin ASIN Scout eklentisini y√ºklemeniz gerekiyor</div>
            <a href="#" class="ext-download-btn" onclick="downloadExtension(event)" data-i18n="ext_modal_download">‚¨áÔ∏è Eklentiyi ƒ∞ndir</a>
            <div class="ext-steps">
                <div class="ext-steps-title">üìñ <span data-i18n="ext_modal_how_title">Nasƒ±l Kurulur?</span></div>
                <div class="ext-step">
                    <div class="ext-step-num">1</div>
                    <div class="ext-step-text" data-i18n="ext_modal_step1">Yukarƒ±daki butona tƒ±klayarak <strong>extension.zip</strong> dosyasƒ±nƒ± indirin</div>
                </div>
                <div class="ext-step">
                    <div class="ext-step-num">2</div>
                    <div class="ext-step-text" data-i18n="ext_modal_step2">ZIP dosyasƒ±nƒ± a√ßƒ±n ve bir klas√∂re √ßƒ±kartƒ±n</div>
                </div>
                <div class="ext-step">
                    <div class="ext-step-num">3</div>
                    <div class="ext-step-text" data-i18n="ext_modal_step3">Chrome'da <strong>chrome://extensions</strong> adresine gidin</div>
                </div>
                <div class="ext-step">
                    <div class="ext-step-num">4</div>
                    <div class="ext-step-text" data-i18n="ext_modal_step4">Saƒü √ºstten <strong>"Geli≈ütirici modu"</strong>nu a√ßƒ±n</div>
                </div>
                <div class="ext-step">
                    <div class="ext-step-num">5</div>
                    <div class="ext-step-text" data-i18n="ext_modal_step5"><strong>"Paketlenmemi≈ü √∂ƒüe y√ºkle"</strong> butonuna tƒ±klayƒ±p √ßƒ±karttƒ±ƒüƒ±nƒ±z klas√∂r√º se√ßin</div>
                </div>
                <div class="ext-step">
                    <div class="ext-step-num">6</div>
                    <div class="ext-step-text" data-i18n="ext_modal_step6">Kurulum tamamlandƒ±! ≈ûimdi <strong>sayfayƒ± yenileyin</strong> ve tekrar deneyin</div>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/js/i18n.js"></script>
    <script src="assets/js/auth.js"></script>
    <script>
        const API='/api';
        const token=AuthHelper.getToken();
        if(!token)location.href='login.html';
        const user=AuthHelper.getUser()||{};
        AuthHelper.startTokenRefresh();
        document.getElementById('userName').textContent=user.name||'User';
        document.getElementById('userEmail').textContent=user.email||'';
        document.getElementById('userAvatar').textContent=(user.name||'U')[0].toUpperCase();
        if(user.is_affiliate){document.getElementById('affiliateLink').style.display='block';}

        let currentPage=1,totalPages=1;

        async function loadScans(page=1){
            const r=await fetch(API+`/scans.php?action=list&page=${page}&limit=20`,{headers:{'Authorization':'Bearer '+token}});
            const d=await r.json();
            if(d.success){
                const scans=d.data.scans,p=d.data.pagination;
                currentPage=p.page;totalPages=p.pages;
                if(scans.length===0){
                    document.getElementById('scansContainer').innerHTML='<div class="empty">'+t('scans_no_scans')+'</div>';
                    document.getElementById('pagination').style.display='none';
                    return;
                }
                let h='<table><thead><tr><th>'+t('scans_store')+'</th><th>'+t('scans_marketplace')+'</th><th>'+t('scans_asins_col')+'</th><th>'+t('scans_pages_col')+'</th><th>'+t('scans_status')+'</th><th>'+t('scans_date')+'</th><th>'+t('scans_actions')+'</th></tr></thead><tbody>';
                for(const s of scans){
                    h+=`<tr>
                        <td><strong>${s.store_url ? '<a href="'+esc(s.store_url)+'" target="_blank" style="color:var(--orange);text-decoration:none" title="'+esc(s.store_url)+'">'+esc(s.store_name||'Unknown')+' ‚Üó</a>' : esc(s.store_name||'Unknown')}</strong></td>
                        <td>${esc(s.marketplace||'-')}</td>
                        <td><strong style="color:var(--green)">${fmt(s.asin_count)}</strong></td>
                        <td>${fmt(s.pages_scanned)}</td>
                        <td><span class="badge ${s.status==='completed'?'green':'red'}">${s.status}</span></td>
                        <td>${new Date(s.created_at).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-sr" onclick="loadToSR(${s.id},'${esc(s.store_name||'Unknown')}',this)">SR</button>
                            <button class="btn btn-sf" onclick="loadToSF(${s.id},'${esc(s.store_name||'Unknown')}',this)">SF</button>
                            <button class="btn btn-copy" onclick="copyAsins(${s.id},this)">Kopyala</button>
                            <a href="scan-detail.html?id=${s.id}" class="btn btn-outline">${t('scans_view')}</a>
                            <a href="${API}/scans.php?action=download&id=${s.id}&format=txt&token=${token}" class="btn btn-outline">TXT</a>
                            <a href="${API}/scans.php?action=download&id=${s.id}&format=excel&token=${token}" class="btn btn-outline">Excel</a>
                            <button class="btn btn-red" onclick="deleteScan(${s.id})">üóëÔ∏è</button>
                        </td>
                    </tr>`;
                }
                document.getElementById('scansContainer').innerHTML=h+'</tbody></table>';
                if(totalPages>1){
                    document.getElementById('pagination').style.display='flex';
                    document.getElementById('pageInfo').textContent=t('scans_page')+' '+currentPage+' '+t('scans_of')+' '+totalPages;
                    document.getElementById('prevBtn').disabled=currentPage<=1;
                    document.getElementById('nextBtn').disabled=currentPage>=totalPages;
                }else{document.getElementById('pagination').style.display='none';}
            }
        }

        async function deleteScan(id){
            if(!confirm(t('scans_confirm_delete')))return;
            await fetch(API+`/scans.php?action=delete&id=${id}`,{headers:{'Authorization':'Bearer '+token}});
            loadScans(currentPage);
        }

        function logout(){AuthHelper.logout();}
        function fmt(n){return n>=1000?Math.round(n/1000)+'K':String(n||0);}
        function esc(s){return String(s||'').replace(/</g,'&lt;');}
        let currentAsins = [];

        async function copyAsins(scanId,btn){
            btn.textContent='...';
            try{
                const r=await fetch(API+'/scans.php?action=asins&id='+scanId,{headers:{'Authorization':'Bearer '+token}});
                const d=await r.json();
                if(d.success&&d.data.asins){
                    currentAsins = d.data.asins;
                    btn.textContent='üìã';
                    showCopyModal();
                }else{
                    btn.textContent='!';
                    setTimeout(()=>{btn.textContent='üìã';},2000);
                }
            }catch(e){btn.textContent='!';setTimeout(()=>{btn.textContent='üìã';},2000);}
        }

        function showCopyModal(){
            const grid = document.getElementById('chunkGrid');
            grid.innerHTML = '';
            const chunkSize = 5000;
            const total = currentAsins.length;

            if(total <= chunkSize){
                // Tek parca - direkt kopyala
                navigator.clipboard.writeText(currentAsins.join('\n'));
                alert(total + ' ASIN kopyalandƒ±!');
                return;
            }

            const chunks = Math.ceil(total / chunkSize);
            for(let i = 0; i < chunks; i++){
                const start = i * chunkSize;
                const end = Math.min((i + 1) * chunkSize, total);
                const btn = document.createElement('button');
                btn.className = 'chunk-btn';
                btn.textContent = fmtRange(start) + ' - ' + fmtRange(end);
                btn.onclick = async function(){
                    const chunk = currentAsins.slice(start, end);
                    await navigator.clipboard.writeText(chunk.join('\n'));
                    this.classList.add('copied');
                    this.textContent = '‚úì Kopyalandƒ±!';
                    setTimeout(()=>{
                        this.classList.remove('copied');
                        this.textContent = fmtRange(start) + ' - ' + fmtRange(end);
                    }, 2000);
                };
                grid.appendChild(btn);
            }

            document.getElementById('copyAllBtn').textContent = 'T√ºm√ºn√º Kopyala (' + fmtRange(total) + ' ASIN)';
            document.getElementById('copyModal').classList.add('active');
        }

        function closeCopyModal(){
            document.getElementById('copyModal').classList.remove('active');
        }

        // Modal disina tiklaninca kapat
        document.getElementById('copyModal').addEventListener('click', function(e){
            if(e.target === this) closeCopyModal();
        });

        async function copyAllAsins(){
            await navigator.clipboard.writeText(currentAsins.join('\n'));
            const btn = document.getElementById('copyAllBtn');
            btn.textContent = '‚úì T√ºm√º Kopyalandƒ±!';
            btn.style.background = 'linear-gradient(135deg,#22c97a,#1db36a)';
            setTimeout(()=>{
                btn.textContent = 'T√ºm√ºn√º Kopyala (' + fmtRange(currentAsins.length) + ' ASIN)';
                btn.style.background = '';
            }, 2000);
        }

        function fmtRange(n){ return n.toLocaleString('tr-TR'); }

        // Extension modal fonksiyonlari
        function showExtModal() {
            document.getElementById('extModal').classList.add('active');
        }
        function closeExtModal() {
            document.getElementById('extModal').classList.remove('active');
        }
        // Modal disina tiklaninca kapat
        document.getElementById('extModal').addEventListener('click', function(e) {
            if (e.target === this) closeExtModal();
        });

        // Extension download
        async function downloadExtension(e) {
            if (e) e.preventDefault();
            try {
                const r = await fetch('/api/packages.php?action=extension_url');
                const d = await r.json();
                if (d.success && d.data.url) {
                    window.location.href = d.data.url;
                } else if (d.data.chrome_store) {
                    window.open(d.data.chrome_store, '_blank');
                } else {
                    window.location.href = '/downloads/extension.zip';
                }
            } catch(err) {
                window.location.href = '/downloads/extension.zip';
            }
        }

        // Seller Running'e yukle
        async function loadToSR(scanId, storeName, btn) {
            // Extension yuklu mu kontrol et
            const hasExtension = document.documentElement.hasAttribute('data-asinscout-extension');
            if (!hasExtension) {
                showExtModal();
                return;
            }

            btn.textContent = '...';
            try {
                const r = await fetch(API + '/scans.php?action=asins&id=' + scanId, {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const d = await r.json();
                if (d.success && d.data.asins && d.data.asins.length > 0) {
                    // Custom event ile eklentiye gonder
                    window.dispatchEvent(new CustomEvent('asinscout-sr-load', {
                        detail: {
                            asins: d.data.asins,
                            storeName: storeName,
                            scanId: scanId
                        }
                    }));
                    btn.textContent = '‚úì';
                    btn.style.background = 'linear-gradient(135deg,#22c97a,#1db36a)';
                    setTimeout(() => {
                        btn.textContent = 'SR';
                        btn.style.background = '';
                    }, 2000);
                } else {
                    btn.textContent = '!';
                    alert('ASIN bulunamadi!');
                    setTimeout(() => { btn.textContent = 'SR'; }, 2000);
                }
            } catch(e) {
                btn.textContent = '!';
                alert('Hata: ' + e.message);
                setTimeout(() => { btn.textContent = 'SR'; }, 2000);
            }
        }

        // Seller Flash'a yukle
        async function loadToSF(scanId, storeName, btn) {
            // Extension yuklu mu kontrol et
            const hasExtension = document.documentElement.hasAttribute('data-asinscout-extension');
            if (!hasExtension) {
                showExtModal();
                return;
            }

            btn.textContent = '...';
            try {
                const r = await fetch(API + '/scans.php?action=asins&id=' + scanId, {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const d = await r.json();
                if (d.success && d.data.asins && d.data.asins.length > 0) {
                    // Custom event ile eklentiye gonder
                    window.dispatchEvent(new CustomEvent('asinscout-sf-load', {
                        detail: {
                            asins: d.data.asins,
                            storeName: storeName,
                            scanId: scanId
                        }
                    }));
                    btn.textContent = '‚úì';
                    btn.style.background = 'linear-gradient(135deg,#22c97a,#1db36a)';
                    setTimeout(() => {
                        btn.textContent = 'SF';
                        btn.style.background = '';
                    }, 2000);
                } else {
                    btn.textContent = '!';
                    alert('ASIN bulunamadi!');
                    setTimeout(() => { btn.textContent = 'SF'; }, 2000);
                }
            } catch(e) {
                btn.textContent = '!';
                alert('Hata: ' + e.message);
                setTimeout(() => { btn.textContent = 'SF'; }, 2000);
            }
        }

        // Re-render on language change
        window.addEventListener('languageChanged',()=>{loadScans(currentPage);});
        loadScans();
    </script>
</body>
</html>
